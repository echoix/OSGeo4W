diff --git a/frmts/ecw/ecwdataset.cpp b/frmts/ecw/ecwdataset.cpp
index 5b4825e04a..7a956637e0 100644
--- a/frmts/ecw/ecwdataset.cpp
+++ b/frmts/ecw/ecwdataset.cpp
@@ -73,6 +73,10 @@ ECWRasterBand::ECWRasterBand(ECWDataset *poDSIn, int nBandIn, int iOverviewIn,
     nRasterYSize = poDS->GetRasterYSize() / (1 << (iOverview + 1));
 
 #if ECWSDK_VERSION >= 51
+// undefine min macro if any
+#ifdef min
+#undef min
+#endif
     if (poDSIn->bIsJPEG2000 && poDSIn->poFileView)
     {
         UINT32 nTileWidth = 0;
diff --git a/gcore/gdal_priv_templates.hpp b/gcore/gdal_priv_templates.hpp
index 96840e1e56..896c733fec 100644
--- a/gcore/gdal_priv_templates.hpp
+++ b/gcore/gdal_priv_templates.hpp
@@ -31,7 +31,7 @@
 #ifdef USE_NEON_OPTIMIZATIONS
 #include "include_sse2neon.h"
 #else
-#include <emmintrin.h>
+#include <immintrin.h>
 #endif
 
 static inline void GDALCopyXMMToInt32(const __m128i xmm, void *pDest)
